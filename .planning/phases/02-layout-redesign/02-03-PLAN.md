---
phase: 02-layout-redesign
type: execute
---

<objective>
Accounts/index.ctp und Transactions/index.ctp mit Welcome-Section und Stats.

Purpose: Konsistentes Dashboard-Feeling in allen Admin-Views
Output: Beide Views mit Welcome-Section und Statistik-Cards
</objective>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/Template/Accounts/index.ctp
@src/Template/Transactions/index.ctp
@src/Controller/AccountsController.php
@src/Controller/TransactionsController.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Accounts/index Welcome-Section</name>
  <files>src/Template/Accounts/index.ctp</files>
  <action>
  Am Anfang (analog zu Users/index):

  <div class="welcome-section">
      <h1 class="welcome-title">Kontenverwaltung</h1>
      <p class="welcome-date">
          <i class="bi bi-calendar3 me-1"></i>
          <?= date('l, d. F Y') ?>
      </p>
  </div>

  <div class="row g-3 mb-4">
      <div class="col-md-6">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon">
                      <i class="bi bi-wallet2"></i>
                  </div>
                  <div class="stat-value"><?= count($accounts) ?></div>
                  <div class="stat-label">Konten</div>
              </div>
          </div>
      </div>
      <div class="col-md-6">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon positive">
                      <i class="bi bi-currency-euro"></i>
                  </div>
                  <div class="stat-value text-success">
                      <?= $this->Number->currency($totalBalance ?? 0, 'EUR') ?>
                  </div>
                  <div class="stat-label">Gesamtguthaben</div>
              </div>
          </div>
      </div>
  </div>
  </action>
  <verify>Welcome-Section und 2 Stat-Cards vorhanden</verify>
  <done>Accounts/index hat Dashboard-Header</done>
</task>

<task type="auto">
  <name>Task 2: AccountsController Stats</name>
  <files>src/Controller/AccountsController.php</files>
  <action>
  In index()-Methode:

  # Gesamtguthaben berechnen
  $totalBalance = 0;
  foreach ($accounts as $account) {
      $totalBalance += $account->balance;
  }
  $this->set('totalBalance', $totalBalance);
  </action>
  <verify>$totalBalance wird berechnet und gesetzt</verify>
  <done>View hat Zugriff auf totalBalance</done>
</task>

<task type="auto">
  <name>Task 3: Transactions/index Welcome-Section</name>
  <files>src/Template/Transactions/index.ctp</files>
  <action>
  Am Anfang:

  <div class="welcome-section">
      <h1 class="welcome-title">Transaktionsuebersicht</h1>
      <p class="welcome-date">
          <i class="bi bi-calendar3 me-1"></i>
          <?= date('l, d. F Y') ?>
      </p>
  </div>

  <div class="row g-3 mb-4">
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon">
                      <i class="bi bi-receipt"></i>
                  </div>
                  <div class="stat-value"><?= $this->Paginator->param('count') ?></div>
                  <div class="stat-label">Transaktionen</div>
              </div>
          </div>
      </div>
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon positive">
                      <i class="bi bi-arrow-down-left"></i>
                  </div>
                  <div class="stat-value text-success">
                      +<?= $this->Number->currency($einnahmen ?? 0, 'EUR') ?>
                  </div>
                  <div class="stat-label">Einnahmen</div>
              </div>
          </div>
      </div>
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon negative">
                      <i class="bi bi-arrow-up-right"></i>
                  </div>
                  <div class="stat-value text-danger">
                      -<?= $this->Number->currency($ausgaben ?? 0, 'EUR') ?>
                  </div>
                  <div class="stat-label">Ausgaben</div>
              </div>
          </div>
      </div>
  </div>
  </action>
  <verify>Welcome-Section und 3 Stat-Cards vorhanden</verify>
  <done>Transactions/index hat Dashboard-Header</done>
</task>

<task type="auto">
  <name>Task 4: TransactionsController Stats (optional)</name>
  <files>src/Controller/TransactionsController.php</files>
  <action>
  In index()-Methode (falls sinnvoll):

  # Einnahmen/Ausgaben summieren - nur wenn performant
  # Bei vielen Transaktionen besser per SQL-Aggregation

  $einnahmen = 0;
  $ausgaben = 0;
  # Nur bei ueberschaubarer Menge:
  if ($transactions->count() <= 1000) {
      foreach ($transactions as $t) {
          # Logik haengt von Transaktionsstruktur ab
      }
  }
  $this->set(compact('einnahmen', 'ausgaben'));

  HINWEIS: Wenn Transaktionen paginiert sind, macht Aggregation
  nur fuer aktuelle Seite Sinn. Alternativ: Aggregations-Query.
  </action>
  <verify>Einnahmen/Ausgaben werden gesetzt (oder 0 als Fallback)</verify>
  <done>Stats in View verfuegbar</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Accounts/index hat Welcome-Section + Stats
- [ ] Transactions/index hat Welcome-Section + Stats
- [ ] php -l fuer alle geaenderten Dateien
- [ ] Visuell pruefen dass Design konsistent
</verification>

<success_criteria>
- Alle Admin-Views haben Dashboard-Header
- Stats werden korrekt angezeigt
- Bestehende Funktionalitaet erhalten
</success_criteria>

<output>
Nach Abschluss: `.planning/phases/02-layout-redesign/02-03-SUMMARY.md` erstellen
</output>
