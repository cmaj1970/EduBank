---
phase: 02-layout-redesign
type: execute
---

<objective>
Users/index.ctp von Tabellen-Layout zu Dashboard-Stil umbauen.

Purpose: Konsistentes UX wie Schueler-Dashboard (Accounts/view.ctp)
Output: Card-basierte Uebungsfirmen-Uebersicht mit Stats
</objective>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/Template/Users/index.ctp
@src/Template/Accounts/view.ctp (Ziel-Design)
@webroot/css/bootstrap-custom.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Welcome-Section hinzufuegen</name>
  <files>src/Template/Users/index.ctp</files>
  <action>
  Am Anfang der View (nach PHP-Block) Welcome-Section einfuegen:

  <div class="welcome-section">
      <h1 class="welcome-title">Uebungsfirmen-Verwaltung</h1>
      <p class="welcome-date">
          <i class="bi bi-calendar3 me-1"></i>
          <?= date('l, d. F Y') ?>
      </p>
  </div>

  Das entspricht dem Muster aus Accounts/view.ctp
  </action>
  <verify>View beginnt mit welcome-section div</verify>
  <done>Welcome-Section vorhanden mit Datum</done>
</task>

<task type="auto">
  <name>Task 2: Statistik-Cards oberhalb Tabelle</name>
  <files>src/Template/Users/index.ctp</files>
  <action>
  Nach Welcome-Section, vor der Tabelle, Statistik-Cards einfuegen:

  <div class="row g-3 mb-4">
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon">
                      <i class="bi bi-building"></i>
                  </div>
                  <div class="stat-value"><?= count($users) ?></div>
                  <div class="stat-label">Uebungsfirmen</div>
              </div>
          </div>
      </div>
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon positive">
                      <i class="bi bi-wallet2"></i>
                  </div>
                  <div class="stat-value"><?= $totalAccounts ?? 0 ?></div>
                  <div class="stat-label">Konten gesamt</div>
              </div>
          </div>
      </div>
      <div class="col-md-4">
          <div class="card">
              <div class="stat-card">
                  <div class="stat-icon">
                      <i class="bi bi-currency-euro"></i>
                  </div>
                  <div class="stat-value text-success">
                      <?= $this->Number->currency($totalBalance ?? 0, 'EUR') ?>
                  </div>
                  <div class="stat-label">Gesamtguthaben</div>
              </div>
          </div>
      </div>
  </div>

  Controller muss $totalAccounts und $totalBalance bereitstellen (Task 3).
  </action>
  <verify>Statistik-Cards im Markup vorhanden</verify>
  <done>3 Statistik-Cards zeigen Uebungsfirmen, Konten, Guthaben</done>
</task>

<task type="auto">
  <name>Task 3: Controller-Variablen fuer Stats</name>
  <files>src/Controller/UsersController.php</files>
  <action>
  In index()-Methode (Schuladmin-Bereich) nach dem Query:

  # Statistiken berechnen
  $totalAccounts = 0;
  $totalBalance = 0;
  foreach ($users as $user) {
      if (!empty($user->accounts)) {
          foreach ($user->accounts as $account) {
              $totalAccounts++;
              $totalBalance += $account->balance;
          }
      }
  }
  $this->set(compact('totalAccounts', 'totalBalance'));

  NICHT in Admin-Bereich (der hat andere Logik).
  </action>
  <verify>$totalAccounts und $totalBalance werden gesetzt</verify>
  <done>View hat Zugriff auf Statistik-Variablen</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Welcome-Section sichtbar
- [ ] 3 Statistik-Cards oberhalb Tabelle
- [ ] Zahlen werden korrekt berechnet und angezeigt
- [ ] php -l src/Template/Users/index.ctp ohne Fehler
- [ ] php -l src/Controller/UsersController.php ohne Fehler
</verification>

<success_criteria>
- Dashboard-Stil erkennbar
- Statistiken funktionieren
- Bestehende Tabellen-Funktionalitaet erhalten
</success_criteria>

<output>
Nach Abschluss: `.planning/phases/02-layout-redesign/02-01-SUMMARY.md` erstellen
</output>
